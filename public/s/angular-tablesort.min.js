var tableSortModule=angular.module("tableSort",[]);tableSortModule.directive("tsWrapper",["$log","$parse",function(a,b){"use strict";return{scope:!0,controller:["$scope",function(a){a.sortExpression=[],a.headings=[];var c=function(a){return[b(a),null,!1]};this.setSortField=function(b,d){var e,f=c(b);if(1===a.sortExpression.length&&a.sortExpression[0][0]===f[0])a.sortExpression[0][2]?(d.removeClass("tablesort-desc"),d.addClass("tablesort-asc"),a.sortExpression[0][2]=!1):(d.removeClass("tablesort-asc"),d.addClass("tablesort-desc"),a.sortExpression[0][2]=!0);else{for(e=0;e<a.headings.length;e+=1)a.headings[e].removeClass("tablesort-desc").removeClass("tablesort-asc");d.addClass("tablesort-asc"),a.sortExpression=[f]}},this.addSortField=function(b,d){var e,f=!1,g=c(b);for(e=0;e<a.sortExpression.length;e+=1)a.sortExpression[e][0]===g[0]&&(a.sortExpression[e][2]?(d.removeClass("tablesort-desc"),d.addClass("tablesort-asc"),a.sortExpression[e][2]=!1):(d.removeClass("tablesort-asc"),d.addClass("tablesort-desc"),a.sortExpression[e][2]=!0),f=!0);f||(d.addClass("tablesort-asc"),a.sortExpression.push(g))},this.registerHeading=function(b){a.headings.push(b)},a.sortFun=function(b,c){var d,e,f,g,h;for(d=0;d<a.sortExpression.length;d+=1){if(e=a.sortExpression[d][0](b),f=a.sortExpression[d][0](c),h=c[a.sortExpression[d][1]],h&&(e=h(e),f=h(f)),void 0===e&&(e=""),void 0===f&&(f=""),g=a.sortExpression[d][2],e>f)return g?-1:1;if(f>e)return g?1:-1}return 0}}]}}]),tableSortModule.directive("tsCriteria",function(){return{require:"^tsWrapper",link:function(a,b,c,d){var e=function(e){a.$apply(function(){e.shiftKey?d.addSortField(c.tsCriteria,b):d.setSortField(c.tsCriteria,b)})};b.bind("click",e),b.addClass("tablesort-sortable"),"tsDefault"in c&&"0"!==c.tsDefault&&(d.addSortField(c.tsCriteria,b),"descending"==c.tsDefault&&d.addSortField(c.tsCriteria,b)),d.registerHeading(b)}}}),tableSortModule.directive("tsRepeat",["$compile",function(a){return{terminal:!0,require:"^tsWrapper",priority:1e6,link:function(b,c){var d=c.clone(),e=c[0].childElementCount,f=d.attr("ng-repeat");f=f.replace(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(\s+track\s+by\s+[\s\S]+?)?\s*$/,"$1 in $2 | tablesortOrderBy:sortFun$3"),c.html("<td colspan='"+e+"'></td>"),c[0].className+=" showIfLast",d.removeAttr("ts-repeat"),d.attr("ng-repeat",f);var g=a(d)(b);c.after(g)}}}]),tableSortModule.filter("tablesortOrderBy",function(){return function(a,b){if(a){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);return c.sort(b)}}}),tableSortModule.filter("parseInt",function(){return function(a){return parseInt(a)}}),tableSortModule.filter("parseFloat",function(){return function(a){return parseFloat(a)}});