var pattern;pattern=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;n=["\\","[","]",".","^","$","|","?","*","+","(",")","{","}"],t==null&&(t=!1),i=function(e){var t,r,i;for(r=0,i=n.length;r<i;r++)t=n[r],e=e.replace(t,"\\"+t);return e},u=function(e,t){var n,r,s;return r=/%(\w+)%/g,n=function(){var t;t=[];while(s=r.exec(e))t.push(s[1]);return t}(),{attributes:n,toExtract:function(t){return s=i(e).replace("%"+t+"%","(?<value>[a-zA-Z0-9_.-]+)"),s=s.replace(r,"[a-zA-Z0-9_.-]+"),s},toFilter:function(){var n;return n=i(e).replace(r,"[a-zA-Z0-9_.-]+"),t&&(n+="\\b"),{script:{script:"pattern_filter",params:{pattern:n}}}}}};if(!e)return{query:null,attributes:[],filters:[]};h=[],a=[],g=e.split("|");for(p=0,v=g.length;p<v;p++)l=g[p],l=l.trim(),l.indexOf("parse")===0?a.push(u(l.substring(5).trim(),t)):h=h.concat(l.split(/\s+/));h.length===0?f=null:f={bool:{must:function(){var e,t,n;n=[];for(e=0,t=h.length;e<t;e++)c=h[e],n.push({multi_match:{query:c,fields:["_all"]}});return n}()}},r=[],s=[];for(d=0,m=a.length;d<m;d++)o=a[d],r=r.concat(o.attributes),s.push(o.toFilter());return{query:f,attributes:r,filters:s,toBucket:function(e){var t,n,r;for(n=0,r=a.length;n<r;n++){o=a[n];if(o.attributes.indexOf(e)>=0)return t=o.toExtract(e),{script:"pattern_extract",lang:"groovy",params:{pattern:t,onlyNumber:!1},size:300}}return null},toMetric:function(e){var t,n,r;for(n=0,r=a.length;n<r;n++){o=a[n];if(o.attributes.indexOf(e)>=0)return t=o.toExtract(e),{script:"pattern_extract",lang:"groovy",params:{pattern:t,onlyNumber:!0}}}return null},applyFilter:function(t,n){var r,i;return r="%"+t+"%",i=e.replace(r,n),e.indexOf(r)+r.length===e.length?pattern(i,!0):pattern(i,!1)}}};