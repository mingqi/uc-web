{"version":3,"file":"config.min.js","sources":["uncompressed/config.js"],"names":["setObject","list","object","_","some","old","i","_id","splice","push","removeObject","angular","module","controller","$scope","$http","$location","get","success","hosts","extend","page","newFiles","platforms","key","name","venderPage","$on","locationSearch","search","mainContent","tab","changeTab","deleteFile","host","file","confirm","hostname","ma","wait","post","hostId","done","refreshHosts","oldHostMap","indexBy","each","selectedWhenAddFile","submitAddFiles","hostIds","chain","filter","map","value","length","path"],"mappings":"AAAA,GAAIA,WAAY,SAASC,EAAMC,GAC7BD,EAAOA,MACFE,EAAEC,KAAKH,EAAM,SAASI,EAAKC,GAC5B,MAAID,GAAIE,MAAQL,EAAOK,KACnBN,EAAKO,OAAOF,EAAG,EAAGJ,IACX,GAFX,UAMAD,EAAKQ,KAAKP,IAGZQ,aAAe,SAAST,EAAMC,GAChCD,EAAOA,MACPE,EAAEC,KAAKH,EAAM,SAASI,EAAKC,GACzB,MAAID,GAAIE,MAAQL,EAAOK,KACrBN,EAAKO,OAAOF,EAAG,IACR,GAFT,SAOJK,SAAQC,OAAO,cAAe,cAC7BC,WAAW,QAAS,SAAU,QAAS,YAAa,SAASC,EAAQC,EAAOC,GAC3ED,EAAME,IAAI,0BAA0BC,QAAQ,SAASC,GACjDhB,EAAEiB,OAAON,GACPO,QACAF,MAAOA,EACPG,YACAC,YACIC,IAAK,SACLC,KAAM,sBAEND,IAAK,SACLC,KAAM,qBAEND,IAAK,QACLC,KAAM,mBAGZC,IACAZ,EAAOa,IAAI,yBAA0BD,IAGzC,IAAIA,GAAa,WACb,GAAIE,GAAiBZ,EAAUa,QAC/Bf,GAAOgB,YAAcF,EAAeG,KAAO,aAG/CjB,GAAOkB,UAAY,SAASD,GACpBf,EAAUa,SAASE,MAAQA,GAG/Bf,EAAUa,OAAO,MAAOE,IAG5BjB,EAAOmB,WAAa,SAASC,EAAMC,GAC1BC,QAAQ,gBAAkBF,EAAKG,SAAW,IAAMF,KAGrDG,GAAGC,OACHxB,EAAMyB,KAAK,4BACTC,OAAQP,EAAK3B,IACb4B,KAAMA,IACLjB,QAAQ,SAASgB,GAClBI,GAAGI,OACH1C,UAAUc,EAAOK,MAAOe,OAI9BpB,EAAO6B,aAAe,WACpBL,GAAGC,OACHxB,EAAME,IAAI,0BAA0BC,QAAQ,SAASC,GACjD,GAAIyB,GAAazC,EAAE0C,QAAQ/B,EAAOK,MAAO,MACzChB,GAAE2C,KAAK3B,EAAO,SAASe,GACrBA,EAAKa,oBAAsBH,EAAWV,EAAK3B,MAAQqC,EAAWV,EAAK3B,KAAKwC,sBAE1EjC,EAAOK,MAAQA,EACfmB,GAAGI,UAIT5B,EAAOkC,eAAiB,WACtB,GAAIC,GAAU9C,EAAE+C,MAAMpC,EAAOK,OAAOgC,OAAO,SAASjB,GAClD,MAAOA,GAAKa,sBACXK,IAAI,SAASlB,GACd,MAAOA,GAAK3B,MACX8C,OAEEJ,GAAQK,SAIbhB,GAAGC,OACHxB,EAAMyB,KAAK,0BACTS,QAASA,EACT3B,SAAUnB,EAAEiD,IAAItC,EAAOQ,SAAU,SAASa,GACxC,MAAOA,GAAKoB,SAEbrC,QAAQ,SAASC,GAClBmB,GAAGI,OACH5B,EAAOkB,UAAU,cACjB7B,EAAE2C,KAAK3B,EAAO,SAASe,GACrBlC,UAAUc,EAAOK,MAAOe,KAG1BpB,EAAOQ,YACPnB,EAAEiB,OAAON,EAAOK,OACd4B,qBAAqB","sourcesContent":["var setObject = function(list, object) {\n  list = list || [];\n  if (!_.some(list, function(old, i) {\n      if (old._id === object._id) {\n          list.splice(i, 1, object);\n          return true;\n      }\n  })) {\n      // new\n      list.push(object);\n  }\n};\nvar removeObject = function(list, object) {\n  list = list || [];\n  _.some(list, function(old, i) {\n    if (old._id === object._id) {\n      list.splice(i, 1);\n      return true;\n    }\n  })\n}\n\nangular.module('consoleApp', ['tableSort'])\n.controller('Ctrl', ['$scope', '$http', '$location', function($scope, $http, $location) {\n  $http.get('/console/ajax/getHosts').success(function(hosts) {\n      _.extend($scope, {\n        page: {},\n        hosts: hosts,\n        newFiles: [],\n        platforms: [{\n            key: 'redhat',\n            name: 'Red Hat or CentOS'\n        }, {\n            key: 'debian',\n            name: 'Ubuntu or Debian'\n        }, {\n            key: 'linux',\n            name: 'Others linux'\n        }]\n      });\n      venderPage();\n      $scope.$on('$locationChangeSuccess', venderPage);\n  });\n\n  var venderPage = function() {\n      var locationSearch = $location.search();\n      $scope.mainContent = locationSearch.tab || 'seeConfigs';\n  };\n\n  $scope.changeTab = function(tab) {\n      if ($location.search().tab === tab) {\n          return;\n      }\n      $location.search('tab', tab);\n  };\n\n  $scope.deleteFile = function(host, file) {\n      if (!confirm('停止收集日志文件:\\n\\n' + host.hostname + ':' + file)) {\n        return;\n      }\n      ma.wait();\n      $http.post('/console/ajax/deleteFile', {\n        hostId: host._id,\n        file: file\n      }).success(function(host) {\n        ma.done();\n        setObject($scope.hosts, host);\n      });\n  };\n\n  $scope.refreshHosts = function() {\n    ma.wait();\n    $http.get('/console/ajax/getHosts').success(function(hosts) {\n        var oldHostMap = _.indexBy($scope.hosts, '_id');\n        _.each(hosts, function(host) {\n          host.selectedWhenAddFile = oldHostMap[host._id] && oldHostMap[host._id].selectedWhenAddFile;\n        });        \n        $scope.hosts = hosts;\n        ma.done();\n    });\n  };\n\n  $scope.submitAddFiles = function() {\n    var hostIds = _.chain($scope.hosts).filter(function(host) {\n      return host.selectedWhenAddFile;\n    }).map(function(host) {\n      return host._id;\n    }).value();\n\n    if (!hostIds.length) {\n      return;\n    }\n\n    ma.wait();\n    $http.post('/console/ajax/addFiles', {\n      hostIds: hostIds,\n      newFiles: _.map($scope.newFiles, function(file) {\n        return file.path;\n      })\n    }).success(function(hosts) {\n      ma.done();\n      $scope.changeTab('seeConfigs');\n      _.each(hosts, function(host) {\n        setObject($scope.hosts, host);\n      });\n\n      $scope.newFiles = [];\n      _.extend($scope.hosts, {\n        selectedWhenAddFile: false\n      });\n    });\n  };\n}]);\n"]}