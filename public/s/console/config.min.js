var setObject=function(a,b){a=a||[],_.some(a,function(c,d){return c._id===b._id?(a.splice(d,1,b),!0):void 0})||a.push(b)},removeObject=function(a,b){a=a||[],_.some(a,function(c,d){return c._id===b._id?(a.splice(d,1),!0):void 0})};angular.module("consoleApp",["tableSort"]).controller("Ctrl",["$scope","$http","$location",function(a,b,c){b.get("/console/ajax/getHosts").success(function(b){_.extend(a,{page:{},hosts:b,newFiles:[],platforms:[{key:"redhat",name:"Red Hat or CentOS"},{key:"debian",name:"Ubuntu or Debian"},{key:"linux",name:"Others linux"}]}),d(),a.$on("$locationChangeSuccess",d)});var d=function(){var b=c.search();a.mainContent=b.tab||"seeConfigs"};a.changeTab=function(a){c.search().tab!==a&&c.search("tab",a)},a.deleteFile=function(c,d){confirm("停止收集日志文件:\n\n"+c.hostname+":"+d)&&(ma.wait(),b.post("/console/ajax/deleteFile",{hostId:c._id,file:d}).success(function(b){ma.done(),setObject(a.hosts,b)}))},a.refreshHosts=function(){ma.wait(),b.get("/console/ajax/getHosts").success(function(b){var c=_.indexBy(a.hosts,"_id");_.each(b,function(a){a.selectedWhenAddFile=c[a._id]&&c[a._id].selectedWhenAddFile}),a.hosts=b,ma.done()})},a.submitAddFiles=function(){var c=_.chain(a.hosts).filter(function(a){return a.selectedWhenAddFile}).map(function(a){return a._id}).value();c.length&&(ma.wait(),b.post("/console/ajax/addFiles",{hostIds:c,newFiles:_.map(a.newFiles,function(a){return a.path})}).success(function(b){ma.done(),a.changeTab("seeConfigs"),_.each(b,function(b){setObject(a.hosts,b)}),a.newFiles=[],_.extend(a.hosts,{selectedWhenAddFile:!1})}))}}]);